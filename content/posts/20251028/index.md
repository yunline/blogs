---
tags:
  - 嵌入式
  - 光学
  - 哈基米
---


# 光透过率计-原理篇-其一

> *摘要：* 暂时还没有什么摘要可写

## 引言

大家看，这是诗歌剧。诗歌剧，和大家打个招呼。

**诗歌剧：** 曼波~

诗歌剧一直想要一台仪器，用来测量样品对可见光的透过率。你能帮她想想办法吗？

**帝王：** 那你直接买个分光光度计不就完了吗？

然而贫穷的曼波买不起分光光度计。为了圆梦，曼波决定自己制作一台低成本的透过率计。

于是她拿起烙铁，很快就做出了第一个透过率计的原型。

### 原型1

这就是诗歌剧做的第一个透过率计，可以看到，这台设备主要由一只发光二极管和一个光电传感器。

接通电源，发光二极管点亮，光电传感器被照亮，输出一定的电压信号。

使用时，先测量没有样品时，光电传感器输出的信号强度，记作 $V_0$。然后放入样品，测得此时输出强度 $V_1$，于是我们就可以算得透过率 
$$
T = \frac{V_1}{V_0}
$$

**帝王：** 你这个仪器设计得有问题啊。啊米诺斯。

是的，正如哈基米所说，这台仪器存在比较严重的缺陷。

我们看透过率的定义

$$
T = \frac{I_1}{I_0}
$$

可以看到，透过率是光穿过样品之前的光强值与光穿过样品之后的光强值的比值。

诗歌剧给出的透过率却是电压的比值。

显然，光电传感器输出的电压是光强的函数，即 $V(I)$。按照诗歌剧的算法，她显然近似地认为 $V$ 正比于 $I$。就像是物理专业的同学们，喜欢把 $\tan(\theta)$ 近似为 $\sin(\theta)$ 一样。

然而现实世界是残酷的，光电传感器输出的电压和所接收到的光强并不成正比。简单地将电压值相除，只会得到一个错得离谱的答案。

**诗歌剧：** 曼波（悲伤）

## 原型2

很快，诗歌剧做出了第二代原型。 

新的仪器比第一代多一组偏振片。其中一片偏振片固定，步进电机带动另一片偏振片旋转，可以使偏振片旋转到指定的夹角。

使用时，首先让两组偏振片方向平行（$\theta = 0$），然后插入样品，测得传感器输出 $V_1$。

取走样品，调节偏振片的角度，使光强衰减，让光电传感器的读数等于 $V_1$。这时候，偏振片的透过率恰好等于样品的透过率。

现在，读出偏振片的夹角 $\theta_1$，我们就可以通过马吕斯定律轻松算得偏振片此时的透过率，也就是样品的透过率
$$
T = \frac{I_1}{I_0} = \frac{I_0\cdot\frac{1}{2}\cdot\cos^2\theta_1}{I_0} = \frac{\cos^2\theta_1}{2}
$$

这个设计确实精妙，使用了等效代换法，将不易测量的变量转化为容易测量的变量。

**诗歌剧：** 曼波~（开心）

**哈基米：** WOW~

**哈基米：** 你这个步进电机的角度分辨率怎么只有1.8度，精度完全不够啊。

**哈基米：** 而且你这个齿轮怎么间隙这么大，这角度能准确吗？啊米诺斯。

显然，诗歌剧并不是机械设计专业的学生，于是她苦学solidworks，终于画出了啮合紧密无间隙的渐开线齿轮。

**诗歌剧：** 曼波~

然而不幸的是，由于减速比不足，该装置的角度分辨率只能达到十分有限的水平。鉴于精密减速装置昂贵的价格，诗歌剧不得不放弃这个方案。

**诗歌剧：** 曼波（悲伤）

QB找到悲伤的诗歌剧，说是能帮她实现愿望。于是诗歌剧许愿能设计出一个完美的透明度计。

**QB：** 契约成立了，你的许愿凌驾了熵

**诗歌剧：** 曼波

*放音乐*

停停停走错片场了。总之诗歌剧在实验室里醒过来，继续改进她的透过率计。

### PWM？

曼波想，既然要调节输出的光强，那为什么不直接调节发光二极管的光强呢？

实际上，这种方法她之前并非没考虑过。但是显然，发光二极管所发出的光强与电压并不线性，与电流也不线性。于是便无法由电压的比值或电流的比值准确计算透光率。

真的没有一种办法，能够完全线性地控制LED的发光强度吗？

**诗歌剧：** 曼波？

有的兄弟有的。诗歌剧在实验楼里闲逛，看到了学电子信息专业的学弟学妹们正在研究用单片机和PWM实现呼吸灯。*对啦！我就是为蓝猫配音的演员* **脉冲宽度调制（PWM）**。

我们放弃去“调节”LED的亮度本身，而是利用它最稳定、最确定的两个状态——“全开”（在额定电流下，发出固定光强 $I_0$​ ）和 “全关”（光强为 $0$ ）。

让LED在这两个状态间以极其高的频率切换。光电传感器无法响应如此高速的变化。它所感知到的，是一个平均光强。

这个平均光强 $I$，只取决于在一个周期内，LED“开”的时间所占的比例（即占空比）。计算公式非常简单：

$$
I = I_0\cdot d =  I_0\cdot\frac{t_{点亮}}{t_{熄灭} + t_{点亮}}
$$

通过线性地改变占空比 $d$，我们就能精确且线性地控制这个平均光强 $I$。

### 原型3

很快曼波设计出了第三代原型机。

新的仪器结构和第一代的很相似，都是由一个led和一个光电传感器组成。与之前不同的是，led和光电传感器都接入了一个单片机。

首先进行校准，单片机以 $d_0 = 50\%$ 占空比的PWM脉冲驱动led输出 $50\%\cdot I_0$ 的光强。等光电传感器的输出电压稳定之后，单片机使用adc读出其电压值 $V_0$并存储起来。

接着放入样品，让单片机进入测量模式。单片机使用PID控制器调节PWM的占空比，使得光传感器输出的电压等于$V_0$。这时，光传感器接收到的光强与校准时的光强完全一致。读出这时候的PWM占空比 $d_1$。

由于等效代换原理，我们可以列出这样的方程，很快就能求出透射率 $T$ 。

$$
d_0 \cdot I_0 = d_1 \cdot T \cdot I_0
$$

$$
T = \frac{d_0}{d_1} = \frac{50\%}{d_1}
$$

**哈基米：** 啊米诺斯。

**哈基米：** 哪里需要搞这么麻烦啊，PID还要调参，调不好还震荡，收敛也慢。还需要cpu不停地做计算，要是没带fpu的单片机，还可能有性能瓶颈。啊米诺斯。

看起来东海帝王对这个话题很有看法。让我们看看她的想法吧。

### 原型4

**东海帝王：** 哈基米哈基米哈基米~哈基米喔南北绿豆。。。。

歌词大意：

（未完待续，明天再写吧）
